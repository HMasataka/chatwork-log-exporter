# Chatwork Log Exporter - Chrome拡張機能

Chatworkのチャットルームからメッセージと添付ファイルをエクスポートするChrome拡張機能です。

## 機能

- チャットルームのメッセージを一括ダウンロード
- 添付ファイルのダウンロード
- 複数ルームの選択的なエクスポート
- カスタマイズ可能な設定（通信間隔、日時追加、ユーザー名追加など）
- 企業用Chatworkにも対応

## インストール方法

### 1. アイコン画像の準備

manifest.jsonで指定されているアイコンファイルを作成する必要があります：

- `icon16.png` (16x16ピクセル)
- `icon48.png` (48x48ピクセル)
- `icon128.png` (128x128ピクセル)

簡易的なアイコンを作成する方法：

```bash
# ImageMagickを使用する場合
convert -size 16x16 xc:blue icon16.png
convert -size 48x48 xc:blue icon48.png
convert -size 128x128 xc:blue icon128.png
```

または、任意の画像編集ソフトで上記のサイズのPNG画像を作成してください。

### 2. Chrome拡張機能の読み込み

1. Chromeブラウザで `chrome://extensions/` を開く
2. 右上の「デベロッパーモード」をオンにする
3. 「パッケージ化されていない拡張機能を読み込む」をクリック
4. このプロジェクトのディレクトリを選択

## 使い方

### 1. 設定

拡張機能のアイコンをクリックして設定画面を開きます。

#### 基本設定

- **チャットワークのホスト名**: デフォルトは `www.chatwork.com`。企業用の場合は適宜変更（例: `kcw.kddi.ne.jp`）
- **通信間隔**: ミリ秒単位で指定。データ規模が大きい場合は1000（1秒）程度を推奨

#### ルーム設定

- **取得したいルームID**: カンマ区切りで入力。空欄の場合は全ルームを対象
- **除外するルームID**: カンマ区切りで入力。ログ用ルーム等の除外に使用

#### カスタマイズ設定

- **メッセージに日時を追加**: YYYY/MM/DD HH:MM:SS形式の時刻を追加
- **メッセージにユーザー名を追加**: 発言者のユーザー名を追加（標準ではアカウントIDのみ）
- **リアクション情報を削除**: 不要な場合にチェック
- **添付ファイルをダウンロード**: 添付ファイルもダウンロードする

### 2. エクスポート実行

1. Chatworkにログインする
2. 任意のChatworkページを開く
3. 拡張機能のアイコンをクリック
4. 設定を確認・変更
5. 「ログをエクスポート」ボタンをクリック

### 3. 出力ファイル

以下のファイルがダウンロードフォルダに保存されます：

- `init_load.json`: 全ルーム情報
- `{ルームID}_load_chat.json`: ルーム詳細情報
- `{ルームID}_messages.json`: メッセージデータ
- `{ルームID}_account_info.json`: アカウント情報
- `{ルームID}_{ルーム名}.txt`: ルーム名参照用の空ファイル
- `{ルームID}_{ファイルID}_{ファイル名}`: 添付ファイル

## messages.jsonの構造

```json
[
  {
    "id": "123451234512345",
    "aid": 1234567,
    "msg": "Hello World",
    "type": "text_message_type",
    "tm": 1234567,
    "utm": 0,
    "index": 12,
    "reactions": [],
    "datetime": "2024/12/12 12:12:12",
    "aid_name": "田中太郎"
  }
]
```

## 注意事項

- このツールはChatworkの非公式APIを使用しています
- 大量のデータをダウンロードする場合は、通信間隔を適切に設定してください（推奨: 1000ms以上）
- エクスポート中はブラウザのタブを閉じないでください
- Chatworkのサーバーに負荷をかけないよう、節度を持って使用してください

## ファイル構成

```
.
├── manifest.json          # 拡張機能の設定ファイル
├── popup.html            # 設定画面のHTML
├── popup.js              # 設定画面のロジック
├── styles.css            # 設定画面のスタイル
├── content.js            # メイン処理（Chatworkページに注入）
├── background.js         # バックグラウンドスクリプト
├── icon16.png            # アイコン（16x16）
├── icon48.png            # アイコン（48x48）
└── icon128.png           # アイコン（128x128）
```

## トラブルシューティング

### エラー: ACCESS_TOKEN or MYID not found

Chatworkにログインしているか確認してください。また、Chatworkの仕様変更により変数名が変更されている可能性があります。

### エクスポートが途中で止まる

通信間隔を長く設定してください（1000ms以上）。

### ファイルがダウンロードされない

ブラウザのダウンロード設定を確認してください。複数ファイルのダウンロードを許可する必要があります。

## ライセンス

このプロジェクトは元のスクリプト（[goodbye_chatwork](https://github.com/swdyh/goodbye_chatwork) および [gist](https://gist.github.com/junjanjon/8ce62c1cb90e817b1247de672bf93116)）を参考に作成されています。

## 参考

- 元のスクリプト: https://gist.github.com/junjanjon/8ce62c1cb90e817b1247de672bf93116
- goodbye_chatwork: https://github.com/swdyh/goodbye_chatwork
